<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List of Books</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">

    <style th:replace="~{fragments/fragment :: base-style}"></style>
    <style>

        .filters label {
            font-weight: bold;
            margin-right: 5px;
        }

        .filters input {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .filters button {
            padding: 6px 12px;
            background-color: #0b6c4b;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: auto;
        }

        .filters button:hover {
            background-color: #095b3e;
        }

        .action-buttons form button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

    </style>
</head>
<body>
<div th:replace="~{fragments/fragment :: navbar}"></div>

<div class="container mt-4">
    <h1 class="mb-4">Book List</h1>

    <div class="filters border rounded p-3 mb-4 bg-light">
        <form method="get" th:action="@{/books}">
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-control" name="title" th:value="${title}">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Author</label>
                    <input type="text" class="form-control" name="author" th:value="${author}">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Publisher</label>
                    <input type="text" class="form-control" name="publisher" th:value="${publisher}">
                </div>

                <div class="col-md-2">
                    <label class="form-label">Price</label>
                    <input type="number" class="form-control" name="price" th:value="${price}">
                </div>

                <div class="col-md-2 d-flex align-items-end">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="inStock" th:checked="${inStock != null and inStock}">
                        <label class="form-check-label">In Stock</label>
                    </div>
                </div>

                <div class="col-md-2">
                    <label class="form-label">Start Year</label>
                    <input type="number" class="form-control" name="startYear" th:value="${startYear}">
                </div>

                <div class="col-md-2">
                    <label class="form-label">End Year</label>
                    <input type="number" class="form-control" name="endYear" th:value="${endYear}">
                </div>

                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-success w-100">Filter</button>
                </div>
            </div>
        </form>
    </div>


    <div th:each="book : ${bookPage}"
         class="border p-3 mb-3 rounded shadow-sm"
         th:classappend="${book.inStock} ? 'border-success bg-light text-success' : 'border-danger bg-light text-danger'">
        <h5 th:text="${book.title}"></h5>
        <p><strong>Price:</strong> â‚¬<span th:text="${book.price}"></span></p>
        <p th:if="${book.inStock}" class="text-success">In Stock</p>
        <p th:unless="${book.inStock}" class="text-danger">Out of Stock</p>

        <div class="d-flex gap-2">
            <form th:action="@{books/{id}(id=${book.id})}" method="get">
                <button type="submit" class="btn btn-outline-success btn-sm">View</button>
            </form>
            <form th:action="@{/books/update/{id}(id=${book.id})}" method="get">
                <button type="submit" class="btn btn-outline-primary btn-sm">Update</button>
            </form>
            <form th:action="@{/books/delete/{id}(id=${book.id})}" method="post">
                <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
            </form>
        </div>
    </div>

    <div class="d-flex justify-content-center mt-4">
        <form method="get" th:action="@{/books}">
            <!-- Keep all filter values -->
            <input type="hidden" name="title" th:value="${title}" />
            <input type="hidden" name="author" th:value="${author}" />
            <input type="hidden" name="publisher" th:value="${publisher}" />
            <input type="hidden" name="genre" th:value="${genre}" />
            <input type="hidden" name="price" th:value="${price}" />
            <input type="hidden" name="startYear" th:value="${startYear}" />
            <input type="hidden" name="endYear" th:value="${endYear}" />
            <input type="hidden" name="inStock" th:if="${inStock}" value="true" />

            <ul class="pagination">
                <li class="page-item" th:classappend="${!hasPrevious} ? 'disabled'">
                    <button class="page-link" name="page" value="0">First</button>
                </li>
                <li class="page-item" th:classappend="${!hasPrevious} ? 'disabled'">
                    <button class="page-link" name="page" th:value="${currentPage - 1}">Previous</button>
                </li>

                <li class="page-item" th:each="i : ${#numbers.sequence(0, bookPage.totalPages - 1)}"
                    th:classappend="${i == currentPage} ? 'active'">
                    <button class="page-link" name="page" th:value="${i}" th:text="${i + 1}">1</button>
                </li>

                <li class="page-item" th:classappend="${!hasNext} ? 'disabled'">
                    <button class="page-link" name="page" th:value="${currentPage + 1}">Next</button>
                </li>
                <li class="page-item" th:classappend="${!hasNext} ? 'disabled'">
                    <button class="page-link" name="page" th:value="${bookPage.totalPages - 1}">Last</button>
                </li>
            </ul>
        </form>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>


</body>
</html>